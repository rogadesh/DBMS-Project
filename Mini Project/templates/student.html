<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Performance Tracker</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    
    html, body {
  margin: 0;
  padding: 0;
  height: 100%; /* Ensure full coverage */
  overflow: hidden; /* Prevent background scrolling */
}
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #ff416c, #ff4b2b);
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 800px;
      margin: 30px auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
    }

 /* Modal Overlay */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1000; /* Sit on top */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scrolling if needed */
  background-color: rgba(0, 0, 0, 0.5); /* Black with opacity */
}

/* Modal Content */
.modal-content {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%); /* Center the modal */
  background-color: #fff;
  padding: 20px;
  width: 500px; /* Adjust width as needed */
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  text-align: center;
}

/* Modal Header */
.modal-content h2 {
  margin-bottom: 20px;
  font-size: 22px;
  color: #333;
  text-align: center;
}

/* Form Group Styling */
.modal-content label {
  display: block;
  font-size: 14px;
  font-weight: bold;
  margin: 10px 0 5px;
  color: #555;
  text-align: left;
}

.modal-content select, 
.modal-content input {
  width: 100%;
  margin-bottom: 15px;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 5px;
  font-size: 14px;
  background-color: #f9f9f9;
  text-align: left;
}

/* Buttons Container */
.modal-content .button-container {
  display: flex;
  justify-content: space-between;
  gap: 10px;
  margin-top: 20px;
}

/* Buttons Styling */
.modal-content button {
  flex: 1;
  padding: 10px;
  font-size: 14px;
  background-color: #007bff;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.modal-content button:hover {
  background-color: #0056b3;
}

.modal-open {
  overflow: hidden;
}

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h2 {
      margin: 0;
    }

    .form-group {
      margin: 10px 0;
    }

    label {
      display: block;
      margin-bottom: 5px;
    }

    input {
      width: 95%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .btn-group1 {
    margin-left: 40px;
    margin-top: 15px; /* Space between the button group and the fields above */
    display: flex; /* Arrange buttons horizontally */
    gap: 15px; /* Space between buttons */
    justify-content: flex-start; /* Adjust alignment (use 'space-between' or 'flex-start' for left alignment) */
    flex-wrap: wrap; /* Allow buttons to wrap onto a new line if needed */
  }

  .btn-group1 button {
    padding: 10px 22.5px; /* Padding for uniform button size */
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-align: center;
    white-space: nowrap; /* Prevent button text from wrapping */
  }

  .btn-group1 button:hover {
    background-color: #0056b3;
  }

    .btn-group {
    margin-top: 15px; /* Space between the button group and the fields above */
    display: flex; /* Arrange buttons horizontally */
    gap: 15px; /* Space between buttons */
    justify-content: flex-start; /* Adjust alignment (use 'space-between' or 'flex-start' for left alignment) */
    flex-wrap: wrap; /* Allow buttons to wrap onto a new line if needed */
  }

  .btn-group button {
    padding: 10px 22.5px; /* Padding for uniform button size */
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-align: center;
    white-space: nowrap; /* Prevent button text from wrapping */
  }

  .btn-group button:hover {
    background-color: #0056b3;
  }

    button {
    width: auto; /* Allow the button width to adjust dynamically */
    padding: 10px 15px; /* Add padding for a better appearance */
    border: none;
    background-color: #007bff;
    color: white;
    border-radius: 4px;
    cursor: pointer;
    white-space: nowrap; /* Prevent the text from wrapping to a new line */
    text-align: center; /* Ensure the text is centered */
  }

  button:hover {
    background-color: #0056b3;
  }

  /* Specific styles for aligning and spacing the buttons */
  .btn-container {
    display: flex; /* Arrange buttons horizontally */
    gap: 15px; /* Add space between the buttons */
    justify-content: flex-start; /* Align buttons to the left */
    margin-bottom: 20px; /* Space between buttons and the table */
  }
    /* Close button CSS */
    .modal-header button {
      position: absolute;
      top: 5px;
      right: 5px;
      width: 25px;
      height: 25px;
      padding: 0;
      background-color: #f4f4f9;
      border: none;
      border-radius: 4px;
      font-size: 18px;
      color: #333;
      text-align: center;
      cursor: pointer;
    }

    .modal-header button:hover {
      background-color: #e0e0e0;
    }

    /* Styling for Option Icons in the Table */
    .options {
      display: flex;
      justify-content: space-around;
    }

    .options button {
      border: none;
      background: transparent;
      cursor: pointer;
    }

    .options button:hover {
      opacity: 0.7;
    }

    .edit-icon, .delete-icon {
      font-size: 18px;
      margin: 0 5px;
    }

    /* For edit and delete buttons - Add colors */
    .edit-icon {
      color: #007bff;
    }

    .delete-icon {
      color: #dc3545;
    }

    .checkbox-group {
  display: flex;
  flex-wrap: wrap; /* This will allow the checkboxes to wrap to a new line if needed */
  gap: 15px; /* Space between checkboxes */
}

.checkbox-group label {
  display: flex;
  align-items: center;
}

.checkbox-group input {
  margin-right: 5px; /* Space between checkbox and label text */
}

.radio-group {
  display: flex;
  flex-wrap: wrap; /* This will allow the radio buttons to wrap to a new line if needed */
  gap: 15px; /* Space between radio buttons */
}

.radio-group label {
  display: flex;
  align-items: center;
}

.radio-group input {
  margin-right: 5px; /* Space between radio button and label text */
}

#search-button {
  margin-left: 25px; /* Pushes the button to the right */
  /* margin-top: 10px;  Pushes the button downward */
}
/* Styling for Confirm button */
#confirmButton {
  margin-left: 10px;  /* Space to the right */
  padding: 10px 20px;
  background-color: #007bff;  /* Green background */
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
}

#confirmButton:hover {
  background-color: #0056b3;  /* Slightly darker green on hover */
}

/* Styling for Update button */
#updateButton {
  margin-left: 10px;  /* Space to the left */
  padding: 10px 20px;
  background-color: #008CBA;  /* Blue background */
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
}
.dropdown-container,
.button-container {
  display: inline-block;
  margin-right: 15px;
}

/* Style for the dropdown */
#registerDropdown {
  padding: 10px;
  font-size: 16px;
  border-radius: 4px;
  border: 1px solid #ccc;
  width: 200px; /* Set width for consistency */
}

/* Style for the button */
#fetchStudentDetailsBtn {
  padding: 10px 20px;
  font-size: 16px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

#fetchStudentDetailsBtn:hover {
  background-color: #45a049;
}
  </style>
</head>
<body>
  <div class="container">
    <h1>Student's Academic Performance Tracker</h1>

    <!-- Student Entry Form -->
    <form id="student-form">
      <div class="form-group">
        <label for="register_number">Register Number</label>
        <input type="text" id="register_number" required placeholder="Enter the Register Number" oninput="checkRegisterNumberLength()" />
      </div>
      <div class="form-group">
        <label for="name">Name</label>
        <input type="text" id="name" required placeholder="Enter the Name of the Student"/>
      </div>
      <div class="form-group">
        <label for="department">Department</label>
        <div id="department" class="radio-group">
          <label><input type="radio" name="department" value="IT" /> IT</label>
          <label><input type="radio" name="department" value="CSE" /> CSE</label>
          <label><input type="radio" name="department" value="ECE" /> ECE</label>
          <label><input type="radio" name="department" value="EEE" /> EEE</label>
          <label><input type="radio" name="department" value="EIE" /> EIE</label>
          <label><input type="radio" name="department" value="CIVIL" /> CIVIL</label>
          <label><input type="radio" name="department" value="MECH" /> MECH</label>
          <label><input type="radio" name="department" value="MT" /> MT</label>
        </div>
      </div>
      <div class="form-group">
        <label for="cgpa">CGPA</label>
        <input type="number" id="cgpa" step="0.1" required placeholder="Enter the CGPA"/>
      </div>
      <div class="form-group">
        <label for="attendance">Attendance (%)</label>
        <input type="number" id="attendance" required placeholder="Enter the Percentage of Attendance"/>
      </div>
    </form>

    <!-- Search Student Button -->
     <div class="btn-group">
    <button type="button" onclick="goToPrevious()">Previous</button>
    <button type="button" onclick="toggleInsert()">Insert</button>
    <button type="button" onclick="openUpdateModal()">Update</button>
    <button type="button" onclick="clearModalInputs()">Clear</button>
    <button type="button" onclick="saveChanges()">Save</button>
    <button type="button" onclick="deleteStudent()">Delete</button>
    <button type="button" onclick="commitChanges()">Commit</button>
    <button type="button" onclick="goToNext()">Next</button>    
    </div>
    <div class="btn-group1"> 
      <button onclick="window.location.href='/buffer_records'">Buffer Records</button>
      <button onclick="window.location.href='/add_marks'">Add Marks</button>
      <button onclick="window.location.href='/search_student'">Search Student</button>
      <button onclick="window.location.href='/view_marks'">View Marks</button>
      <button onclick="window.location.href='/database_records'">Database Records</button>
    </div>

<!-- Update Modal -->
<div id="update-modal" class="modal" style="display: none;">
  <div class="modal-content">
    <h2>Update Student Information</h2>
    <label for="update-field">Field to Update</label>
    <select id="update-field" onchange="updateFieldSelection()">
      <option value="">Select Field</option>
      <option value="name">Name</option>
      <option value="department">Department</option>
      <option value="cgpa">CGPA</option>
      <option value="attendance">Attendance</option>
    </select>

    <!-- Department Dropdown (Only visible when 'Department' is selected) -->
    <div id="department-dropdown" style="display: none;">
      <label for="department-value">Select Department</label>
      <select id="department-value">
        <option value="IT">IT</option>
        <option value="CSE">CSE</option>
        <option value="ECE">ECE</option>
        <option value="EEE">EEE</option>
        <option value="EIE">EIE</option>
        <option value="CIVIL">CIVIL</option>
        <option value="MECH">MECH</option>
        <option value="MT">MT</option>
      </select>
    </div>

    <!-- Generic Text Input for name, cgpa, or attendance -->
    <div id="generic-input" style="display: none;">
      <label for="new-value">New Value</label>
      <input type="text" id="new-value" required placeholder="Enter New Value"/>
    </div>

    <button type="button" onclick="submitUpdate()">Submit Update</button>
    <button type="button" onclick="closeUpdateModal()">Cancel</button>
  </div>
</div>

</div>

  <script>
  let students = [];
let currentIndex = null;
let editingIndex = null;
let insertEnabled = true;

document.addEventListener("DOMContentLoaded", fetchStudents);

function toggleInsert() {
  insertEnabled = !insertEnabled; // Toggle the flag

  // Enable or disable all input fields based on the toggle state
  document.getElementById('register_number').disabled = !insertEnabled;
  document.getElementById('name').disabled = !insertEnabled;
  document.getElementById('cgpa').disabled = !insertEnabled;
  document.getElementById('attendance').disabled = !insertEnabled;

  // Enable or disable the department radio buttons
  const departmentRadios = document.getElementsByName('department');
  departmentRadios.forEach(radio => {
    radio.disabled = !insertEnabled;
  });

  // Update button text and show an alert
  const insertButton = document.querySelector('button[onclick="toggleInsert()"]');
  if (insertEnabled) {
    alert("Insertion is enabled. You can now fill in the fields.");
  } else {
    alert("Insertion is disabled. Fields are now locked.");
  }
}

    function getSelectedDepartment() {
    const departmentRadioButtons = document.getElementsByName('department');
    for (let radioButton of departmentRadioButtons) {
        if (radioButton.checked) {
            return radioButton.value; // Return the selected department value
        }
    }
    return null; // Return null if no department is selected
}

function fetchStudents() {
  fetch("/get_students")
    .then((response) => response.json())
    .then((data) => {
      students = data; // Load students from the server
      renderTable(); // Render the table with fetched data
    })
    .catch((error) => console.error("Error fetching students:", error));
}

function checkRegisterNumberLength() {
      const registerNumber = document.getElementById("register_number").value;

      if (registerNumber.length === 10) {
        fetchStudentDetailsFromBuffer();  // Trigger the fetch when 10 digits are entered
      }
    }

async function fetchAndPopulateStudentDetails() {
  const registerNumber = document.getElementById("register_number").value;

  // Validate input
  if (!registerNumber) {
    alert("Please enter a register number.");
    return;
  }

  try {
    const response = await fetch(`/getStudentDetails/${registerNumber}`);
    
    // Check if the response is successful
    if (response.ok) {
      const student = await response.json();

      if (student) {
        // Populate student details in the form fields
        document.getElementById("name").value = student.name || "";
        document.getElementById("cgpa").value = student.cgpa || "";
        document.getElementById("attendance").value = student.attendance || "";

        // Set the correct department radio button
        const departmentRadios = document.querySelectorAll("input[name='department']");
        departmentRadios.forEach((radio) => {
          radio.checked = radio.value === student.department;
        });
      } else {
        alert("No student found with this register number.");
      }
    } else {
      alert("Failed to fetch student details. Please try again later.");
    }
  } catch (error) {
    console.error("Error:", error);
    alert("An error occurred while fetching student details.");
  }
}

// Open the modal and pre-fill fields
async function openUpdateModal() {
  const registerNumber = document.getElementById("register_number").value.trim();

  // Check if the register number field is empty
  if (!registerNumber) {
    alert("Register Number is required to update a record.");
    return;
  }

  try {
    // Check if the record exists in the buffer
    const response = await fetch("/check_record_exists", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ register_number: registerNumber }),
    });

    const result = await response.json();

    if (!result.exists) {
      alert("No matching record found in the buffer to update.");
      return;
    }

    // If record exists, open the modal
    const modal = document.getElementById("update-modal");
    modal.style.display = "block";
  } catch (error) {
    console.error("Error checking record existence:", error);
    alert("An error occurred while checking the record. Please try again.");
  }
}

function closeUpdateModal() {
  const modal = document.getElementById("update-modal");
  modal.style.display = "none";
}


// Handle field selection in the update modal
function updateFieldSelection() {
  const selectedField = document.getElementById("update-field").value;

  // Show relevant input field based on selected field
  if (selectedField === "department") {
    document.getElementById("department-dropdown").style.display = "block";
    document.getElementById("generic-input").style.display = "none";
  } else if (selectedField === "name" || selectedField === "cgpa" || selectedField === "attendance") {
    document.getElementById("department-dropdown").style.display = "none";
    document.getElementById("generic-input").style.display = "block";

    // Fetch current value from the form
    const currentValue = document.getElementById(selectedField).value;
    document.getElementById("new-value").value = currentValue;
  } else {
    document.getElementById("department-dropdown").style.display = "none";
    document.getElementById("generic-input").style.display = "none";
  }
}

// Submit the update to the backend
function submitUpdate() {
  const registerNumber = document.getElementById("register_number").value;
  const field = document.getElementById("update-field").value;
  const newValue =
    field === "department"
      ? document.getElementById("department-value").value
      : document.getElementById("new-value").value.trim();

  // Validation
  if (!field || !newValue) {
    alert("Please select a field and provide a valid new value.");
    return;
  }

  if (field === "cgpa") {
    const cgpaValue = parseFloat(newValue);
    if (isNaN(cgpaValue) || cgpaValue < 0 || cgpaValue > 10) {
      alert("CGPA must be a number between 0 and 10.");
      return;
    }
  }

  if (field === "attendance") {
    const attendanceValue = parseInt(newValue, 10);
    if (isNaN(attendanceValue) || attendanceValue < 0 || attendanceValue > 100) {
      alert("Attendance must be a number between 0 and 100.");
      return;
    }
  }

  // Send PUT request to the backend
  fetch("/update_student", {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      register_number: registerNumber,
      field: field,
      new_value: newValue,
    }),
  })
    .then((response) => response.json())
    .then((data) => {
      if (data.message) {
        alert(data.message);

        // Update the form field with the new value
        if (field === "name") {
          document.getElementById("name").value = newValue;
        } else if (field === "department") {
          document.querySelector(
            `input[name="department"][value="${newValue}"]`
          ).checked = true;
        } else if (field === "cgpa") {
          document.getElementById("cgpa").value = newValue;
        } else if (field === "attendance") {
          document.getElementById("attendance").value = newValue;
        }
      } else {
        alert(data.error || "An error occurred.");
      }
    })
    .catch((error) => {
      console.error("Error:", error);
      alert("Failed to update. Please try again.");
    })
    .finally(() => {
      closeUpdateModal();
    });
}


// Function to close the modal after update or cancellation
function hideModal() {
  const modal = document.querySelector(".modal");
  if (modal) {
    document.body.removeChild(modal);
  }
}


    function clearModalInputs() {
  // Leave the 'register_number' field untouched
  document.getElementById('name').value = '';
  document.getElementById('cgpa').value = '';
  document.getElementById('attendance').value = '';

  // Uncheck all department radio buttons
  document.querySelectorAll("input[name='department']").forEach(radio => {
    radio.checked = false;
  });
}

async function fetchStudentDetailsFromBuffer() {
      const registerNumber = document.getElementById("register_number").value;

      // Validate if the register number is exactly 10 digits
      if (registerNumber.length === 10) {
        try {
          const response = await fetch(`/getStudentDetailsFromBuffer/${registerNumber}`);
          if (response.ok) {
            const student = await response.json();

            if (student) {
              // Populate form with the student details
              document.getElementById("name").value = student.name || "";
              document.getElementById("cgpa").value = student.cgpa || "";
              document.getElementById("attendance").value = student.attendance || "";

              // Set the correct department radio button
              const departmentRadios = document.querySelectorAll("input[name='department']");
              departmentRadios.forEach((radio) => {
                radio.checked = radio.value === student.department;
              });
            }
          } else {
            // alert("No student found in the buffer with this register number.");
          }
        } catch (error) {
          console.error("Error:", error);
          alert("An error occurred while fetching student details.");
        }
      } else {
        // alert("Please enter a valid 10-digit register number.");
      }
    }

function saveChanges() {
  const student = getStudentData();  // Get data from the form

  // Validate the register number (must be 10 digits)
  const registerNumberPattern = /^\d{10}$/;
  if (!registerNumberPattern.test(student.register_number)) {
    alert("Register number must be exactly 10 digits.");
    return; // Stop further execution if invalid
  }

  // Validate the CGPA (must be between 0 and 10)
  if (student.cgpa < 0 || student.cgpa > 10) {
    alert("CGPA must be between 0 and 10.");
    return; // Stop further execution if invalid
  }

  // Validate attendance (must be less than or equal to 100)
  if (student.attendance > 100) {
    alert("Attendance must be less than or equal to 100.");
    return; // Stop further execution if invalid
  }

  // Validate that at least one department is selected
  if (!student.department) {
    alert("Please select a department.");
    return; // Stop further execution if no department is selected
  }

  // Check if the registration number already exists
  const duplicate = students.some(
    (s) => s.register_number === student.register_number
  );

  if (duplicate) {
    alert("Register number is already available!");
    return; // Prevent insertion if the register number is a duplicate
  }

  // Perform the insert operation (same as the Insert button)
  fetch("/insert_student", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(student),
  })
    .then((response) => response.json())
    .then((data) => {
      alert(data.message); // Display the success message
      students.push(student); // Add the new student locally
      renderTable(); // Re-render the table with updated data
      clearForm(); // Reset form inputs
      closeModal(); // Close the modal
    })
    .catch((error) => console.error("Error inserting student:", error));
}

function commitChanges() {
  // Get the data from the form fields
  const studentData = {
    register_number: document.getElementById("register_number").value.trim(),
    name: document.getElementById("name").value.trim(),
    department: getSelectedDepartment(),
    cgpa: parseFloat(document.getElementById("cgpa").value.trim()),
    attendance: parseFloat(document.getElementById("attendance").value.trim())
  };

  // Validate all fields are filled
  if (!studentData.register_number || !studentData.name || !studentData.department || !studentData.cgpa || !studentData.attendance) {
    alert("All fields are mandatory. Please fill in all fields.");
    return; // Stop execution
  }

  // Validate the register number (must be 10 digits)
  const registerNumberPattern = /^\d{10}$/;
  if (!registerNumberPattern.test(studentData.register_number)) {
    alert("Register number must be exactly 10 digits.");
    return; // Stop execution
  }

  // Validate the CGPA (must be between 0 and 10)
  if (studentData.cgpa < 0 || studentData.cgpa > 10) {
    alert("CGPA must be between 0 and 10.");
    return; // Stop execution
  }

  // Validate attendance (must be less than or equal to 100)
  if (studentData.attendance > 100) {
    alert("Attendance must be less than or equal to 100.");
    return; // Stop execution
  }

  // Validate that at least one department is selected
  if (!studentData.department) {
    alert("Please select a department.");
    return; // Stop execution
  }

  // Send a POST request to the backend to commit the changes
  fetch("/commit_student", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(studentData)
  })
    .then(response => {
      if (response.ok) {
        return response.json(); // Success response
      } else {
        return response.json().then(err => {
          throw new Error(err.error || "Unknown error occurred"); // Handle errors
        });
      }
    })
    .then(data => {
      alert(data.message); // Success message
    })
    .catch(error => {
      console.error("Error:", error);
      alert(error.message || "An error occurred while committing changes!"); // Generic error alert
    });
}

    function goToPrevious() {
  if (editingIndex > 0) {
    editingIndex--;  // Move to the previous student
    setModalData(students[editingIndex]);  // Set the modal data with the previous student's data
  } else {
    alert("This is the first record.");
  }
}

function goToNext() {
  if (students.length === 1) {
    // If there's only one student, fetch and display that record
    setModalData(students[0]);
  } else if (editingIndex < students.length - 1) {
    // Move to the next student
    editingIndex++;  
    setModalData(students[editingIndex]);  // Set the modal data with the next student's data
  } else {
    alert("This is the last record.");
  }
}
function goToNext() {
  if (students.length === 1) {
    // If there's only one student, fetch and display that record
    setModalData(students[0]);
  } else if (editingIndex < students.length - 1) {
    // Move to the next student
    editingIndex++;  
    setModalData(students[editingIndex]);  // Set the modal data with the next student's data
  } else {
    alert("This is the last record.");
  }
}


function setModalData(student) {
    // Set form field values with student data
    document.getElementById("register_number").value = student.register_number;
    document.getElementById("name").value = student.name;
    document.getElementById("cgpa").value = student.cgpa;
    document.getElementById("attendance").value = student.attendance;

    // Set the selected department radio button based on the student's department
    const departmentRadios = document.getElementsByName("department");
    departmentRadios.forEach(radio => {
        if (radio.value === student.department) {
            radio.checked = true;  // Check the radio button corresponding to the student's department
        } else {
            radio.checked = false;  // Uncheck the others
        }
    });

    // Enable the modal and show it
    $('#myModal').modal('show');
}

    function getStudentData() {
  const register_number = document.getElementById("register_number").value.trim();
  const name = document.getElementById("name").value.trim();
  
  // Get the selected department (only one radio button can be selected at a time)
  const department = document.querySelector('input[name="department"]:checked')?.value;
  
  const cgpa = document.getElementById("cgpa").value.trim();
  const attendance = document.getElementById("attendance").value.trim();

  if (!register_number || !name || !department || !cgpa || !attendance) {
    alert("All fields are mandatory!");
    throw new Error("Validation failed: All fields are mandatory.");
  }

  return {
    register_number,
    name,
    department,
    cgpa: parseFloat(cgpa),
    attendance: parseFloat(attendance),
  };
}

function deleteStudent() {
  const registerNumber = document.getElementById("register_number").value;

  // Validate input
  if (!registerNumber) {
    alert("Please enter a register number.");
    return;
  }

  // Proceed with fetch to delete the student using the entered register number
  fetch(`/delete_student/${registerNumber}`, {
    method: "DELETE",
  })
    .then((response) => response.json())
    .then((data) => {
      alert(data.message);  // Show success or error message
      if (data.message === "Student Record deleted successfully from Buffer!") {
        // Optionally, clear the form or remove the student from a local table if necessary
        document.getElementById("student-form").reset();  // Reset the form after successful deletion
      }
    })
    .catch((error) => {
      console.error("Error deleting student:", error);
      alert("An error occurred while deleting the student.");
    });
}


function renderTable() {
  const tableBody = document.querySelector("#studentsTable tbody");
  tableBody.innerHTML = "";  // Clear the existing table rows
  
  students.forEach((student) => {
    const row = document.createElement("tr");
    row.dataset.registerNumber = student.register_number;  // Store the register number for each row
    row.innerHTML = `
      <td>${student.register_number}</td>
      <td>${student.name}</td>
      <td>${student.cgpa}</td>
      <td>${student.attendance}</td>
      <td><button onclick="deleteStudent('${student.register_number}')">Delete</button></td>
    `;
    tableBody.appendChild(row);
  });
}


window.onload = function() {
  fetch('/get_students')
    .then(response => response.json())
    .then(data => {
      students = data; // Assuming the response contains the list of students
      renderTable();  // Populate the table
    })
    .catch((error) => console.error("Error fetching students:", error));
  fetchStudents(); // Fetch the initial data when the page loads

  // Optionally, you can call fetchStudents periodically, e.g., every 1 second
  setInterval(fetchStudents, 1000); // Fetch every 1 second to update the data
};
document.getElementById('searchStudentMarksBtn').addEventListener('click', function() {
    openModal1('searchStudentMarksModal');
  });

  document.getElementById('addMarksBtn').addEventListener('click', function() {
    openModal1('addMarksModal');
  });

// Fetch available register numbers and populate the dropdown
function populateRegisterNumbers() {
  fetch('/get_register_numbers')
    .then(response => response.json())
    .then(data => {
      const dropdown = document.getElementById('registerDropdown');
      dropdown.innerHTML = '<option value="" disabled selected>Choose Register Number</option>';
      data.forEach(registerNumber => {
        const option = document.createElement('option');
        option.value = registerNumber;
        option.textContent = registerNumber;
        dropdown.appendChild(option);
      });
    })
    .catch(error => {
      console.error("Error fetching register numbers:", error);
      alert("Failed to load register numbers.");
    });
}

// Fetch and display the student details for the selected register number
document.getElementById('fetchStudentDetailsBtn').addEventListener('click', function() {
  const registerNumber = document.getElementById('registerDropdown').value;
  if (!registerNumber) {
    alert("Please select a register number.");
    return;
  }

  fetch(`/get_student_details?register_number=${encodeURIComponent(registerNumber)}`)
    .then(response => response.json())
    .then(data => {
      if (data.error) {
        alert(data.error);
        return;
      }

      // Populate the student details table
      const detailsTable = document.getElementById('student-details').querySelector('tbody');
      detailsTable.innerHTML = `
        <tr>
          <td>${data.register_number}</td>
          <td>${data.name}</td>
          <td>${data.department}</td>
          <td>${data.cgpa}</td>
          <td>${data.attendance}</td>
        </tr>
      `;
    })
    .catch(error => {
      console.error("Error fetching student details:", error);
      alert("Failed to fetch student details.");
    });
});

// Initialize the dropdown on page load
window.onload = populateRegisterNumbers;

  </script>
</body>
</html>
